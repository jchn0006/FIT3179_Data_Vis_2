{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Preferred Social Media Platform", "fontSize": 26},
  "data": {"url": "data/SMA.csv"},
  "height": 450,
  "width": "container",
  "autosize": {"type": "fit", "contains": "padding"},

  "transform": [
    {
      "calculate": "datum.Most_Used_Platform == 'KakaoTalk' ? 'Other' : datum.Most_Used_Platform == 'VKontakte' ? 'Other' : datum.Most_Used_Platform == 'LINE' ? 'Other' : datum.Most_Used_Platform ",
      "as": "MUP"
    },
    {
      "aggregate": [{"op": "count", "as": "Count"}],
      "groupby": ["MUP"]
    },
    {
      "stack": "Count",
      "as": ["stack_start", "stack_end"],
      "sort": [{"field": "Count", "order": "descending"}],
      "groupby": ["MUP"]
    },
    {
      "joinaggregate": [{"op": "sum", "field": "Count", "as": "Total"}]
    },
    {
      "calculate": "datum.Count / datum.Total * 100",
      "as": "Percent"
    }
  ],

  "mark": {"type": "arc", "outerRadius": 150},

  "encoding": {
    "theta": {"field": "Percent", "type": "quantitative", "sort" : "-x"},
    "color": {
      "field": "MUP",
      "type": "nominal",
      "title": "Platform",
      "legend" : {"symbolSize" : 200, "labelFontSize": 16, "titleFontSize" : 20},
       "scale": {
      "domain": [
        "Facebook",
        "Instagram",
        "LinkedIn",
        "Other",
        "Snapchat",
        "TikTok",
        "Twitter",
        "WeChat",
        "WhatsApp",
        "YouTube"
      ],
  "range": [
        "#E15759",
        "#F28E2B",
        "#EDC948",
        "#BAB0AC",
        "#76B7B2",
        "#4E79A7",
        "#B07AA1",
        "#FF9DA7",
        "#9C755F",
        "#59A14F"
      ]
  }
    },
    "order" : {"field": "Percent", "type" : "quantitative", "sort": "descending"},
    "tooltip": [
      {"field": "MUP", "title": "Platform"},
      {"field": "Percent", "type": "quantitative", "title": "Percentage of Users", "format": ".2f"}
    ]
  },

  "config": {
    "title": {"fontSize": 22},
    "legend": {"titleFontSize": 12, "labelFontSize": 12},
    "view": {"stroke": null}
  }
}
